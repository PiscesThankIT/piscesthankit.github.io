<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/cropped-favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cropped-favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cropped-favicon-16x16.png">
  <link rel="mask-icon" href="/images/cropped-favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"piscesthankit.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="题外话 为什么 Magento 主题的博客研究起 cordova 来了？因为博主希望解决掉商城的全平台问题。 cordova 是贡献给 Apache 后的开源项目，Phonegap 的核心引擎。cordova 通过 Webview 提供 js 和原生代码之间的桥接，这样就可以利用 JS 来调用原生的代码，实现相应的功能，比如调用相机，地理位置什么的。（这样的介绍好像没什么卵用，总之一句话，cord">
<meta property="og:type" content="article">
<meta property="og:title" content="cordova 插件开发">
<meta property="og:url" content="https://piscesthankit.github.io/cordova-plugin-development-exercise/index.html">
<meta property="og:site_name" content="{ Hello Magento 2 }">
<meta property="og:description" content="题外话 为什么 Magento 主题的博客研究起 cordova 来了？因为博主希望解决掉商城的全平台问题。 cordova 是贡献给 Apache 后的开源项目，Phonegap 的核心引擎。cordova 通过 Webview 提供 js 和原生代码之间的桥接，这样就可以利用 JS 来调用原生的代码，实现相应的功能，比如调用相机，地理位置什么的。（这样的介绍好像没什么卵用，总之一句话，cord">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://piscesthankit.github.io/wp-content/uploads/2017/06/cordova.png">
<meta property="article:published_time" content="2017-06-14T05:39:17.000Z">
<meta property="article:modified_time" content="2022-05-01T09:11:17.232Z">
<meta property="article:author" content="ThankIT">
<meta property="article:tag" content="cordova">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://piscesthankit.github.io/wp-content/uploads/2017/06/cordova.png">

<link rel="canonical" href="https://piscesthankit.github.io/cordova-plugin-development-exercise/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>cordova 插件开发 | { Hello Magento 2 }</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">{ Hello Magento 2 }</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">解决 Magento 2 应用问题，更注重深度挖掘。(ง •̀_•́)ง</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/cordova-plugin-development-exercise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          cordova 插件开发
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-14 13:39:17" itemprop="dateCreated datePublished" datetime="2017-06-14T13:39:17+08:00">2017-06-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/uncategorized/" itemprop="url" rel="index"><span itemprop="name">uncategorized</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a><a href="#%E9%A2%98%E5%A4%96%E8%AF%9D"></a>题外话</h2><p>为什么 Magento 主题的博客研究起 cordova 来了？因为博主希望解决掉商城的全平台问题。 cordova 是贡献给 Apache 后的开源项目，Phonegap 的核心引擎。cordova 通过 Webview 提供 js 和原生代码之间的桥接，这样就可以利用 JS 来调用原生的代码，实现相应的功能，比如调用相机，地理位置什么的。（这样的介绍好像没什么卵用，总之一句话，cordova 是做 APP 跨平台开发的） 博主 14 年的时候用 phonegap 做过一个 APP，当时前端框架用的 jquery mobile。在流畅性上，还是不太理想，但是这个锅个人认为大部分要由 jquery mobile 来背，（：D 当然还有博主水平不够的原因）。最后，权衡开发成本和流畅性，选择混合开发还是划算的。 cordova 是混合开发中非常成熟的方案了。虽然一直在讲 webview 的渲染速度慢，但是近些年手机的运行速度也大大提升了。博主最近下载了一款基于 cordova 的应用，体验了一下，速度是很可以的。 因为 cordova 的插件机制，可以让你调用原生去做事，所以这个速度的优化空间是比较大的。况且，我们还可以在原生中嵌入 cordova 的 webviews ，让他们互通。在某些场景下使用原生的，另一些场景下使用 cordova ，想想还是很吸引人的。 在技术的选择上，常常有太多的争论，本文且不讨论这些，重点记录 cordova Android 插件开发的一个入门 exercise 。</p>
<h2 id="前提"><a href="#前提" class="headerlink" title="前提"></a><a href="#%E5%89%8D%E6%8F%90"></a>前提</h2><p>安装了： cordova Node.js Android SDK 然后通过 npm 安装 plugman</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g plugman</span><br><span class="line">plugman --version</span><br><span class="line">1.4.1</span><br></pre></td></tr></table></figure>

<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a><a href="#%E7%9B%AE%E6%A0%87"></a>目标</h2><p>练习的目的主要是熟悉插件开发的过程。 插件将提供接受一个字符型参数的 <code>echo</code> 方法，然后在成功调用后通过 <code>success</code> 方法返回传入的字符。</p>
<h2 id="创建插件"><a href="#创建插件" class="headerlink" title="创建插件"></a><a href="#%E5%88%9B%E5%BB%BA%E6%8F%92%E4%BB%B6"></a>创建插件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plugman create --name ModusEcho --plugin_id com-moduscreate-plugins-echo --plugin_version 0.0.1 --path modusechoplugin</span><br><span class="line"></span><br><span class="line">ls -l modusechoplugin/ModusEcho</span><br><span class="line"></span><br><span class="line">-rw-r--r--  1 simon  staff  372 Feb  3 12:32 plugin.xml</span><br><span class="line">drwxr-xr-x  2 simon  staff   68 Feb  3 12:32 src</span><br><span class="line">drwxr-xr-x  3 simon  staff  102 Feb  3 12:32 www</span><br></pre></td></tr></table></figure>

<p>这样我们就在当前目录下创建了 <code>modusechoplugin/ModusEcho</code> 内部结构如上面所示。 <code>plugin.xml</code> 看起来是下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27;?&gt;</span><br><span class="line">&lt;plugin id=&quot;com-moduscreate-plugins-echo&quot; version=&quot;0.0.1&quot; xmlns=&quot;http://apache.org/cordova/ns/plugins/1.0&quot; xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line">    &lt;name&gt;ModusEcho&lt;/name&gt;</span><br><span class="line">    &lt;js-module name=&quot;ModusEcho&quot; src=&quot;www/ModusEcho.js&quot;&gt;</span><br><span class="line">        &lt;clobbers target=&quot;cordova.plugins.ModusEcho&quot; /&gt;</span><br><span class="line">    &lt;/js-module&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>

<p>关于 <code>plugin.xml</code> ，参考 <a target="_blank" rel="noopener" href="https://cordova.apache.org/docs/en/latest/plugin_ref/spec.html">Plugin.xml</a>，<code>id</code>、<code>version</code>、<code>name</code> 都是命令中指定的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;clobbers target=&quot;cordova.plugins.ModusEcho&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>这里指定模块将被 export 到 <code>window.cordova.plugins.ModusEcho</code> 这里我们将他改成<code>modusecho</code>，这样就可以通过 <code>modusecho</code> 或者 <code>window.modusecho</code> 访问了，变成下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27;?&gt;</span><br><span class="line">&lt;plugin id=&quot;com-moduscreate-plugins-echo&quot; version=&quot;0.0.1&quot; </span><br><span class="line">xmlns=&quot;http://apache.org/cordova/ns/plugins/1.0&quot; </span><br><span class="line">xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line">  &lt;name&gt;ModusEcho&lt;/name&gt;</span><br><span class="line">  &lt;js-module name=&quot;ModusEcho&quot; src=&quot;www/ModusEcho.js&quot;&gt;</span><br><span class="line">    &lt;clobbers target=&quot;modusecho&quot; /&gt;</span><br><span class="line">  &lt;/js-module&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>

<p>然后来看 <code>www/ModusEcho.js</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var exec = require(&#x27;cordova/exec&#x27;);</span><br><span class="line"></span><br><span class="line">exports.coolMethod = function(arg0, success, error) &#123;</span><br><span class="line">    exec(success, error, &quot;ModusEcho&quot;, &quot;coolMethod&quot;, [arg0]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>我们将他改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var exec = require(&#x27;cordova/exec&#x27;);</span><br><span class="line"></span><br><span class="line">exports.echo = function(arg0, success, error) &#123;</span><br><span class="line">  exec(success, error, &quot;ModusEcho&quot;, &quot;echo&quot;, [arg0]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>The JavaScript interface provides the front-facing interface, making it perhaps the most important part of the plugin. You can structure your plugin’s JavaScript however you like, but you need to call cordova.exec to communicate with the native platform。 就是说这里通过 Cordova bridge 的 <code>exec</code> 方法来调用原生的代码。</p>
<h2 id="创建-cordova-项目做测试用"><a href="#创建-cordova-项目做测试用" class="headerlink" title="创建 cordova 项目做测试用"></a><a href="#%E5%88%9B%E5%BB%BA-cordova-%E9%A1%B9%E7%9B%AE%E5%81%9A%E6%B5%8B%E8%AF%95%E7%94%A8"></a>创建 cordova 项目做测试用</h2><p>这里我们先创建一个 cordova 项目来测试一下。(注意不要在当前创建的插件目录下)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova create testapp com.moduscreate.testapp TestApp</span><br></pre></td></tr></table></figure>

<p>上面的语法是<code>cordova create path [id [name [config]]] [options]</code>，参考 <a target="_blank" rel="noopener" href="https://cordova.apache.org/docs/en/latest/reference/cordova-cli/index.html">Cordova Command-line-interface (CLI) Reference</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd testapp</span><br><span class="line">cordova platform add android</span><br><span class="line">cordova plugin add &lt;path/to/plugin&gt;</span><br></pre></td></tr></table></figure>

<p>eg：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin add ../modusechoplugin/ModusEcho/</span><br></pre></td></tr></table></figure>

<p>博主的目录是： dir&#x2F;testapp cordova 项目 dir&#x2F;modusechoplugin&#x2F;ModusEcho 插件项目 然后我们得到一个错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Error: Invalid Plugin! ..\..\cordova\modusechoplugin\ModusEcho needs a valid package.json</span><br></pre></td></tr></table></figure>

<p>因为插件没有 package.json 下面切换到插件目录（存在 plugin.xml 的目录）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plugman createpackagejson .</span><br></pre></td></tr></table></figure>

<p>然后就生成 package.json 了，这时候再回到 cordova 项目目录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin add ../modusechoplugin/ModusEcho/</span><br></pre></td></tr></table></figure>

<p>这次就成功了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova run android</span><br></pre></td></tr></table></figure>

<p>启用了模拟器，然后就看到经典的画面了。 现在我们可以发现 testapp&#x2F;plugins&#x2F;com-moduscreate-plugin-echo 下面有我们的插件了。</p>
<h2 id="测试不使用-cordova-exec"><a href="#测试不使用-cordova-exec" class="headerlink" title="测试不使用 cordova exec"></a><a href="#%E6%B5%8B%E8%AF%95%E4%B8%8D%E4%BD%BF%E7%94%A8-cordova-exec"></a>测试不使用 cordova exec</h2><p>上面我们的 <code>testapp/plugins/com-moduscreate-plugin-echo/www/ModusEcho.js</code> 是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var exec = require(&#x27;cordova/exec&#x27;);</span><br><span class="line"></span><br><span class="line">exports.coolMethod = function(arg0, success, error) &#123;</span><br><span class="line">  exec(success, error, &quot;ModusEcho&quot;, &quot;coolMethod&quot;, [arg0]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>先把他注释掉，然后改成下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// var exec = require(&#x27;cordova/exec&#x27;);</span><br><span class="line"></span><br><span class="line">// exports.echo = function(arg0, success, error) &#123;</span><br><span class="line">//     exec(success, error, &quot;ModusEcho&quot;, &quot;echo&quot;, [arg0]);</span><br><span class="line">// &#125;;</span><br><span class="line">exports.echojs = function(arg0, success, error) &#123;</span><br><span class="line">  // Do something</span><br><span class="line">  success(arg0);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>然后修改 <code>testapp\www\js\index.js</code> 为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">onDeviceReady: function() &#123;</span><br><span class="line">        this.receivedEvent(&#x27;deviceready&#x27;);</span><br><span class="line">        modusecho.echojs(</span><br><span class="line">        &#x27;Hello Plugin&#x27;,</span><br><span class="line">        function(msg) &#123;</span><br><span class="line">          document.getElementsByTagName(&#x27;h1&#x27;)[0].innerHTML = msg;</span><br><span class="line">        &#125;,</span><br><span class="line">        function(err) &#123;</span><br><span class="line">          document.getElementsByTagName(&#x27;h1&#x27;)[0].innerHTML = err;</span><br><span class="line">        &#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cordova run android</span><br></pre></td></tr></table></figure>

<p>理论上原来的 Apache Cordova 应该被换成 Hello Plugin 也就是说，这里不使用 cordova 的 exec 也完全没有问题，重点是 export 了该方法。 但是实际上由于此处是直接在 cordova 中改写插件，<code>testapp\platforms\android\assets\www\plugins\com-moduscreate-plugins-echo\www\ModusEcho.js</code> 并没有发生变化，这是 cordova 自动生成的一个 js ，并且比原始的 js 多了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cordova.define(&quot;com-moduscreate-plugins-echo.ModusEcho&quot;, function(require, exports, module) &#123;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>所以，直接改写不太 ok ，目前还没找到相关的命令，此处还是更改原来的插件代码，然后在 cordova 项目下先移除，再次添加，这次就成功了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin rm com-moduscreate-plugins-echo</span><br><span class="line">cordova plugin add ../modusechoplugin/ModusEcho/</span><br></pre></td></tr></table></figure>

<h2 id="module-exports"><a href="#module-exports" class="headerlink" title="module.exports"></a><a href="#module.exports"></a>module.exports</h2><p>上面 <code>www/ModusEcho.js</code> 是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exports.echojs = function(arg0, success, error) &#123;</span><br><span class="line">  // Do something</span><br><span class="line">  success(arg0);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>如果写成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    Base: &#123;</span><br><span class="line">        hello: function(arg0, success, error) &#123;</span><br><span class="line">            // Do something</span><br><span class="line">            success(arg0);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>那么我们就该这样引用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">modusecho.Base.hello(</span><br><span class="line">        &#x27;Hello world&#x27;,</span><br><span class="line">        function(msg) &#123;</span><br><span class="line">          document.getElementsByTagName(&#x27;h1&#x27;)[0].innerHTML = msg;</span><br><span class="line">        &#125;,</span><br><span class="line">        function(err) &#123;</span><br><span class="line">          document.getElementsByTagName(&#x27;h1&#x27;)[0].innerHTML = err;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="cordova-exec"><a href="#cordova-exec" class="headerlink" title="cordova exec"></a><a href="#cordova-exec"></a>cordova exec</h2><p>这里还是将 <code>www/ModusEcho.js</code> 改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var exec = require(&#x27;cordova/exec&#x27;);</span><br><span class="line"></span><br><span class="line">exports.echo = function(arg0, success, error) &#123;</span><br><span class="line">  exec(success, error, &quot;ModusEcho&quot;, &quot;echo&quot;, [arg0]);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>cordova 的 exec 接收 5 个参数 <code>function(winParam) &#123;&#125;</code>: A success callback function. Assuming your exec call completes successfully, this function executes along with any parameters you pass to it. <code>function(error) &#123;&#125;</code>: An error callback function. If the operation does not complete successfully, this function executes with an optional error parameter. <code>&quot;service&quot;</code>: The service name to call on the native side. This corresponds to a native class, for which more information is available in the native guides listed below. <code>&quot;action&quot;</code>: The action name to call on the native side. This generally corresponds to the native class method. See the native guides listed below. <code>[/* arguments */]</code>: An array of arguments to pass into the native environment. 现在个 plugin.xml 加上如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;platform name=&quot;android&quot;&gt;</span><br><span class="line">  &lt;config-file target=&quot;config.xml&quot; parent=&quot;/*&quot;&gt;</span><br><span class="line">    &lt;feature name=&quot;ModusEcho&quot;&gt;</span><br><span class="line">      &lt;param name=&quot;android-package&quot;</span><br><span class="line">             value=&quot;com.moduscreate.plugin.ModusEcho&quot;/&gt;</span><br><span class="line">    &lt;/feature&gt;</span><br><span class="line">  &lt;/config-file&gt;</span><br><span class="line">  &lt;source-file src=&quot;src/android/com/moduscreate/plugin/ModusEcho.java&quot; </span><br><span class="line">target-dir=&quot;src/com/moduscreate/plugin&quot; /&gt;</span><br><span class="line">&lt;/platform&gt;</span><br></pre></td></tr></table></figure>

<p>插件目录下的<code>src/android/com/moduscreate/plugin/ModusEcho.java</code> 将会被拷贝到 cordova 项目的 <code>platforms\android\src\com\moduscreate\plugin</code> 下，并且<code>com.moduscreate.plugin.ModusEcho</code> 被映射为 <code>ModusEcho</code> plugin service。（对应 exec 中的 service）</p>
<h2 id="创建-ModusEcho-java"><a href="#创建-ModusEcho-java" class="headerlink" title="创建 ModusEcho.java"></a><a href="#%E5%88%9B%E5%BB%BA-modusecho.java"></a>创建 ModusEcho.java</h2><p>在插件目录创建 <code>src/android/com/moduscreate/plugin/ModusEcho.java</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.moduscreate.plugin;</span><br><span class="line"></span><br><span class="line">import org.apache.cordova.CordovaPlugin;</span><br><span class="line">import org.apache.cordova.CallbackContext;</span><br><span class="line">import org.json.JSONArray;</span><br><span class="line">import org.json.JSONObject;</span><br><span class="line">import org.json.JSONException;</span><br><span class="line">import android.content.Context;</span><br><span class="line">import android.widget.Toast;</span><br><span class="line"></span><br><span class="line">public class ModusEcho extends CordovaPlugin &#123;</span><br><span class="line">  @Override</span><br><span class="line">  public boolean execute(</span><br><span class="line">    String action, </span><br><span class="line">    JSONArray args, </span><br><span class="line">    CallbackContext callbackContext</span><br><span class="line">  ) throws JSONException &#123;</span><br><span class="line">    if (&quot;echo&quot;.equals(action)) &#123;</span><br><span class="line">      echo(args.getString(0), callbackContext);</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return false;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private void echo(</span><br><span class="line">    String msg, </span><br><span class="line">    CallbackContext callbackContext</span><br><span class="line">  ) &#123;</span><br><span class="line">    if (msg == null  msg.length() == 0) &#123;</span><br><span class="line">      callbackContext.error(&quot;Empty message!&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      Toast.makeText(</span><br><span class="line">        webView.getContext(), </span><br><span class="line">        msg, </span><br><span class="line">        Toast.LENGTH_LONG</span><br><span class="line">      ).show();</span><br><span class="line">      callbackContext.success(msg);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改项目的 index.js 为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">onDeviceReady: function() &#123;</span><br><span class="line">        this.receivedEvent(&#x27;deviceready&#x27;);</span><br><span class="line">        modusecho.echo(</span><br><span class="line">            &#x27;Plugin Ready!&#x27;,</span><br><span class="line">            function(msg) &#123;</span><br><span class="line">                document.getElementById(&#x27;deviceready&#x27;).querySelector(&#x27;.received&#x27;).innerHTML = msg;</span><br><span class="line">            &#125;,</span><br><span class="line">            function(err) &#123;</span><br><span class="line">                document.getElementById(&#x27;deviceready&#x27;).innerHTML = &#x27;&lt;p class=&quot;event received&quot;&gt;&#x27; + err + &#x27;&lt;/p&gt;&#x27;;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cordova plugin rm com-moduscreate-plugins-echo</span><br><span class="line">cordova plugin add ../modusechoplugin/ModusEcho/</span><br><span class="line">cordova run android</span><br></pre></td></tr></table></figure>

<p>这样就可以看到： <img src="/wp-content/uploads/2017/06/cordova.png"></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="http://moduscreate.com/plugin-authoring-cordova-6-ios-android/">Plugin Authoring in Cordova 6 for iOS and Android</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/cordova/" rel="tag"># cordova</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/bootstrap-mulilevel-navbar-pc-mobile/" rel="prev" title="bootstrap 多级导航 PC 手机解决方案">
      <i class="fa fa-chevron-left"></i> bootstrap 多级导航 PC 手机解决方案
    </a></div>
      <div class="post-nav-item">
    <a href="/magento-woocommerce-how-many-products-can-they-handle/" rel="next" title="Magento 和 woocommerce 分别可以处理多少产品？">
      Magento 和 woocommerce 分别可以处理多少产品？ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E5%A4%96%E8%AF%9D"><span class="nav-number">1.</span> <span class="nav-text">题外话</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E6%8F%90"><span class="nav-number">2.</span> <span class="nav-text">前提</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87"><span class="nav-number">3.</span> <span class="nav-text">目标</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%8F%92%E4%BB%B6"><span class="nav-number">4.</span> <span class="nav-text">创建插件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-cordova-%E9%A1%B9%E7%9B%AE%E5%81%9A%E6%B5%8B%E8%AF%95%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">创建 cordova 项目做测试用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%B8%8D%E4%BD%BF%E7%94%A8-cordova-exec"><span class="nav-number">6.</span> <span class="nav-text">测试不使用 cordova exec</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#module-exports"><span class="nav-number">7.</span> <span class="nav-text">module.exports</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cordova-exec"><span class="nav-number">8.</span> <span class="nav-text">cordova exec</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA-ModusEcho-java"><span class="nav-number">9.</span> <span class="nav-text">创建 ModusEcho.java</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="nav-number">10.</span> <span class="nav-text">参考文档</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ThankIT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">320</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">137</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ThankIT</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
