<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/cropped-favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cropped-favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cropped-favicon-16x16.png">
  <link rel="mask-icon" href="/images/cropped-favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"piscesthankit.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Why need index *Indexing is how Magento transforms data such as products and categories, to improve the performance of your storefront. For example, if you change the price of an item from $4.99 to $3">
<meta property="og:type" content="article">
<meta property="og:title" content="index">
<meta property="og:url" content="https://piscesthankit.github.io/m2-index/index.html">
<meta property="og:site_name" content="{ Hello Magento 2 }">
<meta property="og:description" content="Why need index *Indexing is how Magento transforms data such as products and categories, to improve the performance of your storefront. For example, if you change the price of an item from $4.99 to $3">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://piscesthankit.github.io/wp-content/uploads/2019/06/custom_indexer.png">
<meta property="og:image" content="https://piscesthankit.github.io/wp-content/uploads/2019/06/mysql_trigger.png">
<meta property="og:image" content="https://piscesthankit.github.io/wp-content/uploads/2019/06/index.png">
<meta property="article:published_time" content="2019-06-07T09:24:45.000Z">
<meta property="article:modified_time" content="2022-05-01T09:11:17.380Z">
<meta property="article:author" content="ThankIT">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://piscesthankit.github.io/wp-content/uploads/2019/06/custom_indexer.png">

<link rel="canonical" href="https://piscesthankit.github.io/m2-index/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>index | { Hello Magento 2 }</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">{ Hello Magento 2 }</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">解决 Magento 2 应用问题，更注重深度挖掘。(ง •̀_•́)ง</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/m2-index/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          index
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-06-07 17:24:45" itemprop="dateCreated datePublished" datetime="2019-06-07T17:24:45+08:00">2019-06-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/M2-Certified-Professional-Developer/" itemprop="url" rel="index"><span itemprop="name">M2 Certified Professional Developer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Why-need-index"><a href="#Why-need-index" class="headerlink" title="Why need index"></a><a href="#why-need-index"></a>Why need index</h2><p>*Indexing is how Magento transforms data such as products and categories, to improve the performance of your storefront. For example, if you change the price of an item from $4.99 to $3.99. Magento must reindex the price change to display it on your storefront. Without indexing, Magento would have to calculate the price of every product on the fly, taking into account shopping cart price rules, bundle pricing, discounts, tier pricing, etc. Loading the price for a product would take a long time, possibly resulting in cart abandonment.*</p>
<h2 id="Add-a-custom-indexer"><a href="#Add-a-custom-indexer" class="headerlink" title="Add a custom indexer"></a><a href="#add-a-custom-indexer"></a>Add a custom indexer</h2><p>create a config file <code>app/code/VendorName/TestModule/etc/indexer.xml</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Indexer/etc/indexer.xsd&quot;&gt;</span><br><span class="line">    &lt;indexer id=&quot;custom_index&quot; view_id=&quot;custom_index&quot; class=&quot;VendorName/TestModule\Model\Indexer\ExampleIndexer&quot; shared_index=&quot;custom_index&quot;&gt;</span><br><span class="line">        &lt;title translate=&quot;true&quot;&gt;Indexer Example&lt;/title&gt;</span><br><span class="line">        &lt;description translate=&quot;true&quot;&gt;Indexer Example&lt;/description&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">            &lt;indexer id=&quot;cataloginventory_stock&quot;/&gt;</span><br><span class="line">        &lt;/dependencies&gt;</span><br><span class="line">    &lt;/indexer&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>The <strong>id</strong> attribute is used to identify this indexer. You can call it when you want to check the status, mode or reindex this indexer by the command line. The <strong>view_id</strong> is the id of view element, which will be defined in the mview configuration file. The <strong>class</strong> attribute is the name to the class, which processes the indexer method. The <strong>shared_index</strong> attribute is used for combining several indexers into groups. While reindexing one of the group indexers, the others will be labeled as valid. The <strong>dependencies</strong> element is used to mark the dependencies between various indexers. Create an <code>app/code/VendorName/TestModule/etc/mview.xml</code> config file, which will be responsible for the indexation by Cron.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;urn:magento:framework:Mview/etc/mview.xsd&quot;&gt;</span><br><span class="line">    &lt;view id=&quot;custom_index&quot; class=&quot;VendorName\TestModule\Model\Indexer\ExampleIndexer&quot; group=&quot;indexer&quot;&gt;</span><br><span class="line">        &lt;subscriptions&gt;</span><br><span class="line">            &lt;table name=&quot;catalog_product_entity&quot; entity_column=&quot;entity_id&quot;/&gt;</span><br><span class="line">        &lt;/subscriptions&gt;</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>The class should implement the interfaces: <code>\Magento\Framework\Indexer\ActionInterface</code>, <code>\Magento\Framework\Mview\ActionInterface</code>. Where the <code>\Magento\Framework\Indexer\ActionInterface</code> interface contains the main indexation methods, and the <code>\Magento\Framework\Mview\ActionInterface interface</code> contains the methods that are applied for the <strong>Update By Schedule mode</strong> of an indexation.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">namespace VendorName\TestModule\Model\Indexer;</span><br><span class="line"></span><br><span class="line">class ExampleIndexer implements \Magento\Framework\Indexer\ActionInterface, \Magento\Framework\Mview\ActionInterface</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute full indexation</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function executeFull()</span><br><span class="line">    &#123;</span><br><span class="line">        // TODO: Implement executeFull() method.</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute partial indexation by ID list</span><br><span class="line">     *</span><br><span class="line">     * @param int[] $ids</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function executeList(array $ids)</span><br><span class="line">    &#123;</span><br><span class="line">        // TODO: Implement executeList() method.</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute partial indexation by ID</span><br><span class="line">     *</span><br><span class="line">     * @param int $id</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function executeRow($id)</span><br><span class="line">    &#123;</span><br><span class="line">        // TODO: Implement executeRow() method.</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Execute materialization on ids entities</span><br><span class="line">     *</span><br><span class="line">     * @param int[] $ids</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line">     * @api</span><br><span class="line">     */</span><br><span class="line">    public function execute($ids)</span><br><span class="line">    &#123;</span><br><span class="line">        // TODO: Implement execute() method.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/wp-content/uploads/2019/06/custom_indexer.png"> After we change our custom indexer to ‘update by schedule mode’, a mysql trigger will be created on table ‘catalog_product_entity’. When we change mode to ‘update on save’, the trigger will be deleted. <img src="/wp-content/uploads/2019/06/mysql_trigger.png"></p>
<h2 id="Practices-Tests"><a href="#Practices-Tests" class="headerlink" title="Practices Tests"></a><a href="#practices-tests"></a>Practices Tests</h2><p><img src="/wp-content/uploads/2019/06/index.png"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a><a href="#references"></a>References</h2><p>Highly Recomend: <a target="_blank" rel="noopener" href="https://amasty.com/blog/comprehensive-guide-to-magento-2-indexing/">COMPREHENSIVE GUIDE TO MAGENTO 2 INDEXING</a> <a target="_blank" rel="noopener" href="https://devdocs.magento.com/guides/v2.3/extension-dev-guide/indexing.html">Dev docs - Indexing overview</a> <a target="_blank" rel="noopener" href="https://magento.stackexchange.com/questions/117030/what-is-mview-in-magento2">what is mview in magento2?</a> <a target="_blank" rel="noopener" href="https://maxchadwick.xyz/blog/digging-into-magento-2-partial-reindexing-implementation">Digging Into Magento 2’s Partial Reindexing Implementation</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/eavsetup-classes/" rel="prev" title="EavSetup classes">
      <i class="fa fa-chevron-left"></i> EavSetup classes
    </a></div>
      <div class="post-nav-item">
    <a href="/getflatcolumns/" rel="next" title="getFlatColumns">
      getFlatColumns <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-need-index"><span class="nav-number">1.</span> <span class="nav-text">Why need index</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Add-a-custom-indexer"><span class="nav-number">2.</span> <span class="nav-text">Add a custom indexer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Practices-Tests"><span class="nav-number">3.</span> <span class="nav-text">Practices Tests</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#References"><span class="nav-number">4.</span> <span class="nav-text">References</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ThankIT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">320</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">137</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ThankIT</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
