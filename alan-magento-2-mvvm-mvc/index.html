<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.1.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/cropped-favicon-180x180.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/cropped-favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/cropped-favicon-16x16.png">
  <link rel="mask-icon" href="/images/cropped-favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"piscesthankit.github.io","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言：Alan Storm 的文章以其深度和专业性给博主留下了深刻的印象，而且他非常注意通过代码实例来讲解。在博主眼中 Alan 绝对是大师级的 Magento 专家，所以博主决定翻译他关于 Magento 2 的文章。本篇原文地址  今天我们来做个 Magento 2 的“Hello World”示例。我们会设置一个新的 URL ,并向你展示如何为这个 URL 创建 phtml 模版。在这个过程">
<meta property="og:type" content="article">
<meta property="og:title" content="Magento 2 简介 —— 不再是 MVC （翻译）">
<meta property="og:url" content="https://piscesthankit.github.io/alan-magento-2-mvvm-mvc/index.html">
<meta property="og:site_name" content="{ Hello Magento 2 }">
<meta property="og:description" content="前言：Alan Storm 的文章以其深度和专业性给博主留下了深刻的印象，而且他非常注意通过代码实例来讲解。在博主眼中 Alan 绝对是大师级的 Magento 专家，所以博主决定翻译他关于 Magento 2 的文章。本篇原文地址  今天我们来做个 Magento 2 的“Hello World”示例。我们会设置一个新的 URL ,并向你展示如何为这个 URL 创建 phtml 模版。在这个过程">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-10-27T05:11:31.000Z">
<meta property="article:modified_time" content="2022-05-01T09:11:17.116Z">
<meta property="article:author" content="ThankIT">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://piscesthankit.github.io/alan-magento-2-mvvm-mvc/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Magento 2 简介 —— 不再是 MVC （翻译） | { Hello Magento 2 }</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">{ Hello Magento 2 }</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">解决 Magento 2 应用问题，更注重深度挖掘。(ง •̀_•́)ง</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://piscesthankit.github.io/alan-magento-2-mvvm-mvc/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ThankIT">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="{ Hello Magento 2 }">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Magento 2 简介 —— 不再是 MVC （翻译）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-10-27 13:11:31" itemprop="dateCreated datePublished" datetime="2016-10-27T13:11:31+08:00">2016-10-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/alan-storm/" itemprop="url" rel="index"><span itemprop="name">alan storm</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><em>前言：Alan Storm 的文章以其深度和专业性给博主留下了深刻的印象，而且他非常注意通过代码实例来讲解。在博主眼中 Alan 绝对是大师级的 Magento 专家，所以博主决定翻译他关于 Magento 2 的文章。本篇<a target="_blank" rel="noopener" href="http://alanstorm.com/magento_2_mvvm_mvc">原文地址</a></em></p>
<p>今天我们来做个 Magento 2 的“Hello World”示例。我们会设置一个新的 URL ,并向你展示如何为这个 URL 创建 phtml 模版。在这个过程中我们要说一说<strong>设计模式</strong>以及 Magento 是怎样的设计模式。不过，这篇文章的核心部分是简单地、可以跟着做的步骤，它会帮助你入门 Magento 2 的模块开发。</p>
<p>等不及的可以去github上下载 <a target="_blank" rel="noopener" href="https://github.com/astorm/magento2-hello-world">Alan 的本篇完整模块代码</a>，但是我们强烈建议你自己完成创建的过程。</p>
<p>对 Magento 1 的开发者来说，一个大的惊喜是 Magento 2 不是一个 Model，View，Controller 的系统。Magento 2 是近似 Model,View,ViewModel(MVVM)的系统，然而他的架构师们还没有给它起一个特定的称呼。</p>
<p>Magento 2 中，当你请求一个URL</p>
<p><code>http://magento.example.com/hello_mvc/hello/world</code></p>
<p>系统会将请求路由到 Controller 类的 execute method，类似于 MVC 系统将请求路由到 Controller 类的 action method。但是，和传统的 MVC 系统不一样的是，这个 Controller 类只负责如下事情：</p>
<ul>
<li>决定使用哪个 page layout</li>
<li>Handling saving data from <code>POST</code> requests</li>
<li>下面两件事情之一：<ul>
<li>让系统 render HTTP response</li>
<li>将用户重定向到下一页或上一页</li>
</ul>
</li>
</ul>
<p>你会发现我们都没提在 View 中设置变量。这是因为每个 View 要自己负责从 model layer, request object,或其他外部系统中取得自己的信息。Magento 将 HTML 页面分解成许多片段，称之为 containers 。每个 container 包含嵌套的对象树，叫做 blocks。每个 block 对象拥有一个 phtml 模板文件，用来指定该 block 对象要展现的 HTML 。按照 MVVC 的说法，Magento 的 block 对象就是 View Model。block 对象将会完成所有对 CRUD models, request object, 外部系统等的数据读入。phtml 模板文件是 View （MVVM 中的 View），他只和 ViewModel 交互（block 对象）</p>
<p>作为模块开发者，如果你想在 Magento 中创建一个新的 URL ，你需要做如下事情：</p>
<ul>
<li>Configure a module to tell Magento which controller it should use for a URL</li>
<li>Configure a module to tell Magento which Block objects should be added to the system</li>
</ul>
<p>看到这里有点招架不住了吧，不要担心。本篇介绍文章的剩余部分会带领你完成建立一个 Magento 2 “Hello World” 模块的所有必要步骤。多练习几次，你就会开始掌握新的术语，以及什么代码应该放在哪里。</p>
<h2 id="关于“Cache-Clearing”的注意点"><a href="#关于“Cache-Clearing”的注意点" class="headerlink" title="关于“Cache Clearing”的注意点"></a><a href="#%E5%85%B3%E4%BA%8E%E2%80%9Ccache-clearing%E2%80%9D%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9"></a>关于“Cache Clearing”的注意点</h2><p>像大多数现代框架一样，Magento 2 使用了很多不同的缓存文件来加快会拖慢速度的操作。这些缓存目的是使系统在生产环境中跑地更快 —— 但是这经常会导致 Magento 没有用最新的配置或源文件，所以看不到变化。</p>
<p>当你在 Magento 2 系统中创建新功能的时候，常常是很有必要清空你的缓存的。你可以通过<code>bin/magento</code>的 CLI 命令(<code>cache:clean</code>)，后台的<code>System -&gt; Cache Management</code>，或者通过删除缓存文件(一般在<code>var/cache</code>文件下，如果你用了缓存引擎则另当别论)来清空缓存。</p>
<p>为让速度飞起来，除了缓存文件，Magneto 2 还生成很多 boilerplate classes。这些文件放在<code>var/generation</code>路径下。当你修改了某些配置或代码文件后，通常有必要重新生成这些文件。目前，没有任何方法(CLI或者后台)可以帮你重新生成。唯一的方法是手动删除<code>var/generation</code>下的文件。</p>
<p>我们会尽量在需要清空缓存和重新生成代码文件的时候给你提个醒的，不过要是你遇到应该起作用却没有起作用的情况时，试试看这样做：先清除缓存和生成的代码文件，然后重新载入页面或是重新运行命令。</p>
<p>这些命令可以帮助你快速地回到正确的道路上。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf /path/to/magento/var/generation/*</span><br><span class="line">rm -rf /path/to/magento/var/cache/*</span><br></pre></td></tr></table></figure>

<h2 id="Magento-2-Hello-World-Module"><a href="#Magento-2-Hello-World-Module" class="headerlink" title="Magento 2 Hello World Module"></a><a href="#magento-2-hello-world-module"></a>Magento 2 Hello World Module</h2><p>今天我们的目标是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">访问这个URL http://magento.example.com/hello_mvc/hello/world 返回 Magento2 默认主题下的 “Hello World” 信息。</span><br></pre></td></tr></table></figure>

<p>从更高的角度来说，我们要完成这个目标的步骤如下：</p>
<ul>
<li>创建一个 Magento 2 的 Module</li>
<li>Configure this module with a route for a URL</li>
<li>Create a class for our controller object</li>
<li>Create a full action name layout handle XML file</li>
<li>Use the full action name layout handle XML file to add a new block to the content container</li>
<li>Create a template for our block</li>
</ul>
<p>上面一些术语我们有的已经提到过了，有的还没有。对熟悉 Magento 1的人来说，有些看起很熟悉，但是改变又很多，你可能想忘记 Magento 1 是怎么工作的了呢。虽然Magento 1 的许多知识在 Magento 2 的许多地方依然是非常宝贵的，但是设想 Magento 2 像 Magneto 1 一样的工作是不能帮助你寻找结果。</p>
<h2 id="创建一个-Magento-2-的-Module"><a href="#创建一个-Magento-2-的-Module" class="headerlink" title="创建一个 Magento 2 的 Module"></a><a href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-magento-2-%E7%9A%84-module"></a>创建一个 Magento 2 的 Module</h2><p>Magento 2 中，Module 让程序员可以以模块化地方式向系统中增加新的代码。当你通过 Module 向系统增加代码时，系统才会知道去哪里找你的代码。Module 还定义了使用PHP 命名空间的规则，这样可以避免和其他开发者的代码冲突。Module 是Magento 2 系统的“头等公民”——核心团队也是使用 Module 来实现前后端功能的哦。</p>
<p>Module 需要被放在<code>app/code</code>文件夹下。Magento 2中所有的 module 都有唯一的名字，这个名字由两部分组成。第一部分是描述创建者（公司、个人或者小组）的单词。有时候称之为 vendor namespace。第二部分，是描述该模块功能的单词。</p>
<p>举例来说，Magento 2 自带的一个模块叫 <code>Magento_Contact</code>。这个第一部分 Magento 描述的是该模块的创建者（Magneto 核心团队）。第二部分 Contact 说的是这个模块干什么事情（给 Magento 增加 Contact form）</p>
<p>我们这个入门教程，就来创建一个叫<code>Pulsestorm_HelloWorldMVVM</code>的 module 吧。要创建这个模块，请你创建相应的文件，把内容复制进去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/etc/module.xml --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../lib/internal/Magento/Framework/Module/etc/module.xsd&quot;&gt;</span><br><span class="line">    &lt;module name=&quot;Pulsestorm_HelloWorldMVVM&quot; setup_version=&quot;0.0.1&quot; /&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>module 一般放在<code>app/code</code>文件夹下，根据 module 的名字我们给他创建文件结构。（Pulsestorm_HelloWorldMVVM 对应 Pulsestorm&#x2F;HelloWorldMVVM）</p>
<p>Magento 2 的 module 将包含许多 XML 配置文件，这些配置文件放在 <code>etc</code> 文件夹下。刚刚创建的<code>module.xml</code>是 module 的主要配置文件。这个文件正是 Magento 核心代码搜索系统的模块时要找的文件。</p>
<p><code>&lt;config/&gt;</code> 根节点就是样板，不用管他，照抄就行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/etc/module.xml --&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../lib/internal/Magento/Framework/Module/etc/module.xsd&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>Magento 2 使用 XSD schema 文件来验证所有 module 配置文件的内容。拷贝就行了，不会有变化。</p>
<p>这个配置文件我们感兴趣的部分是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/etc/module.xml --&gt;</span><br><span class="line">&lt;module name=&quot;Pulsestorm_HelloWorldMVVM&quot; setup_version=&quot;0.0.1&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;module/&gt;</code> 节点告诉 Magento 我们想要给系统添加一个 module。<code>name</code>属性告诉 Magneto module 的名字是什么。<code>setup_version</code>告诉 Magento 我们 module 的版本是什么。这个 version 节点对 Magento 的 setup-resource&#x2F;migration 系统很重要，不过今天我们不展开说。</p>
<p>上面的事情做好后，下面我们向<code>app/etc/config.php</code>文件的全局 module 列表中添加我们的 module。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#File: app/etc/config.php</span><br><span class="line">&lt;?php</span><br><span class="line">return array (</span><br><span class="line">  &#x27;modules&#x27; =&gt;</span><br><span class="line">  array (</span><br><span class="line">    &#x27;Magento_Store&#x27; =&gt; 1,</span><br><span class="line">    &#x27;Magento_AdvancedPricingImportExport&#x27; =&gt; 1,</span><br><span class="line">    &#x27;Magento_Directory&#x27; =&gt; 1,</span><br><span class="line">    //...</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>你看这是一个长长的 module 列表。这个文件是为了让核心代码不用每次请求时都去逐个扫描<code>app/code/*</code>文件。把我们的模块也加入到数组的最后。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#File: app/etc/config.php</span><br><span class="line">&lt;?php</span><br><span class="line">return array (</span><br><span class="line">  &#x27;modules&#x27; =&gt;</span><br><span class="line">  array (</span><br><span class="line">    &#x27;Magento_Store&#x27; =&gt; 1,</span><br><span class="line">    &#x27;Magento_AdvancedPricingImportExport&#x27; =&gt; 1,</span><br><span class="line">    &#x27;Magento_Directory&#x27; =&gt; 1,</span><br><span class="line">    //...</span><br><span class="line">    &#x27;Pulsestorm_HelloWorldMVVM&#x27;=&gt; 1</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Magento Merchant Beta 版本后的更新：beta 版本后核心团队增加了 <code>registration.php</code> 文件，现在每个 module 都需要他。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/registration.php</span><br><span class="line">&lt;?php</span><br><span class="line">\Magento\Framework\Component\ComponentRegistrar::register(</span><br><span class="line">    \Magento\Framework\Component\ComponentRegistrar::MODULE,</span><br><span class="line">    &#x27;Pulsestorm_HelloWorldMVVM&#x27;,</span><br><span class="line">    __DIR__</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上面的文件，除了<code>Pulsestorm_HelloWorldMVVM</code>不同，其他所有的 module 内容都是一样的。第二个参数是你的 module 的全名。</p>
<p>Why is this here here? It’s part of how Magento identifies which modules are installed into a system. This replaces the old Magento 1 app&#x2F;etc&#x2F;module files, and takes the ultimate source of truth for module presence away from app&#x2F;etc&#x2F;config.php.</p>
<h2 id="安装疑难解答"><a href="#安装疑难解答" class="headerlink" title="安装疑难解答"></a><a href="#%E5%AE%89%E8%A3%85%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94"></a>安装疑难解答</h2><p>有几种不同的方法来检查 module 是否正确安装好了。其中一种是使用 CLI 命令<code>module:status</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ php bin/magento module:status</span><br><span class="line">List of enabled modules:</span><br><span class="line">Magento_Store</span><br><span class="line">Magento_AdvancedPricingImportExport</span><br><span class="line">//...</span><br><span class="line">Pulsestorm_HelloWorldMVVM</span><br><span class="line"></span><br><span class="line">List of disabled modules:</span><br><span class="line">//...</span><br></pre></td></tr></table></figure>

<p>这个命令会列出系统中所有安装了的和没有安装的 module</p>
<p>另一种方式是进入后台，在_Stores -&gt; Configuration -&gt; Advanced -&gt; Advanced -&gt; Disable Modules Output_ 查看。</p>
<p>关于module 的创建最后要提醒的是，安装一个新的 module 可能会看到如下错误提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Please upgrade your database: Run &quot;bin/magento setup:upgrade&quot; </span><br><span class="line">from the Magento root directory. </span><br><span class="line">The following modules are outdated:</span><br><span class="line">//...</span><br></pre></td></tr></table></figure>

<p>这里不去深究错误原因，这是 Magento setup resource migration system 发出的警告。他告诉你模块的版本和上次setup resource migration scripts 执行的 module 版本不相符。</p>
<p>别管他，从 CMD 运行如下命令，警告就会消失了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ php bin/magento setup:upgrade</span><br></pre></td></tr></table></figure>

<h2 id="添加-controller-action"><a href="#添加-controller-action" class="headerlink" title="添加 controller action"></a><a href="#%E6%B7%BB%E5%8A%A0-controller-action"></a>添加 controller action</h2><p>我们已经创建了 module，接下来为我们的 URL 配置好路由，并创建一个控制器类。在这之前，我们来做个事情。</p>
<p>Magneto 2 社区版本吸收了许多原来企业版才有的特性。其中就包括 full page caching。这对生产环境来说是非常棒的，然而要是你开着全页缓存，开发一个新的 URL 的话，会有点痛苦。你可以登录后台，到_System -&gt; Cache Management_ 中关了它。如果你让他开着，那么每次请求都要删除缓存，缓存文件在<code>var/page_cache</code>目录下。</p>
<p>之前提到的两个缓存文件夹是<code>var/cache</code> 和<code>var/generation</code></p>
<p>关闭全页缓存后，我们就可以继续前进了。</p>
<h2 id="Magnento-2-的路由"><a href="#Magnento-2-的路由" class="headerlink" title="Magnento 2 的路由"></a><a href="#magnento-2-%E7%9A%84%E8%B7%AF%E7%94%B1"></a>Magnento 2 的路由</h2><p>我们要让 Magento 2 响应如下 URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://magento.example.com/index.php/hello_mvvm/hello/world</span><br></pre></td></tr></table></figure>

<p><code>index.php</code>部分是可以不要的。如果你启用了<code>mod_rewrite</code>（或者是web 服务器其他对应的组建），那么上面的 URL 等价于下面的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://magento.example.com/hello_mvvm/hello/world</span><br></pre></td></tr></table></figure>

<p>在Magento 2 系统中，每个独立的 module 都可以声明一个 <strong>front name</strong>，这个<strong>front name</strong>就是URL 中的第一段，对应我们的URL，就是<code>hello_mvvm</code>。如果一个 module 申明了一个 front name，那么相当于他告诉系统：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Magneto system code 你好，如果你看见任何以 /hello_mvvm 开头的URL，我有他们的控制器。</span><br></pre></td></tr></table></figure>

<p>要让我们的模块声明<code>hello_mvvm</code>的front name，请增加如下配置文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/etc/frontend/routes.xml --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;config xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../../lib/internal/Magento/Framework/App/etc/routes.xsd&quot;&gt;</span><br><span class="line">    &lt;router id=&quot;standard&quot;&gt;</span><br><span class="line">        &lt;route id=&quot;hello_mvvm&quot; frontName=&quot;hello_mvvm&quot;&gt;</span><br><span class="line">            &lt;module name=&quot;Pulsestorm_HelloWorldMVVM&quot; /&gt;</span><br><span class="line">        &lt;/route&gt;</span><br><span class="line">    &lt;/router&gt;</span><br><span class="line">&lt;/config&gt;</span><br></pre></td></tr></table></figure>

<p>这个新创建的<code>routes.xml</code>文件告诉 Magento 我们要声明一个 front name。注意这个文件放在子目录<code>frontend</code>下面。Magnento 2 系统允许开发者创建多个<strong>application areas</strong>。 areas 控制的事情有载入哪个session，检查哪个 access control rule，以及载入那个配置文件。<code>frontend</code> area 就是前台购物应用。如果这里没有看明白也不用担心，乖乖放在指定位置就没事了。</p>
<p><code>&lt;router/&gt;</code>节点包含了我们所有的routes</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;router id=&quot;standard&quot;&gt;</span><br><span class="line">    &lt;!-- ... --&gt;</span><br><span class="line">&lt;/router&gt;</span><br></pre></td></tr></table></figure>

<p>这里<code>id=&quot;standard&quot;</code> 有点让人困惑。如果你为frontend area 设置 URL ，你就得用<code>standard</code>。如果你是为后台应用设置 URL 的话，你就得用<code>id=&quot;admin&quot;</code>。这个原因是历史遗留问题，如果有机会的话，后续的文章会讲到原因。</p>
<p>在<code>&lt;router/&gt;</code>内，我们会看到<code>&lt;route/&gt;</code>标签。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;route id=&quot;hello_mvvm&quot; frontName=&quot;hello_mvvm&quot;&gt;</span><br><span class="line">    &lt;module name=&quot;Pulsestorm_HelloWorldMVVM&quot; /&gt;</span><br><span class="line">&lt;/route&gt;</span><br></pre></td></tr></table></figure>

<p>每个单独的<code>&lt;route/&gt;</code>节点告诉 Magento 我们想要声明一个特定的 front name。<code>frontName</code>的属性值是 URL 第一部分的文本值。比方说<code>frontName=&quot;hello_mvvm&quot;</code>告诉 Magento 我们想要声明的 URL 长下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://magento.example.com/hello_mvvm/*</span><br></pre></td></tr></table></figure>

<p><code>node</code>节点的<code>id</code>属性唯一确定该节点。该<code>id</code>有时候也称为 route 的名称。按照惯例，99.9%的时候，该<code>id</code>的值应该都是和<code>frontName</code>一样的。如果你不知道为什么是这样的——你其实不需要知道。只要让他们一样就好了。</p>
<p>在<code>route</code>节点内，你会看到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;module name=&quot;Pulsestorm_HelloWorldMVVM&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p><code>name</code>属性节点应该是你 module 的名称。上面这些都弄好了以后，我们可以继续去创建控制器文件了。</p>
<h2 id="新建控制器文件"><a href="#新建控制器文件" class="headerlink" title="新建控制器文件"></a><a href="#%E6%96%B0%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E6%96%87%E4%BB%B6"></a>新建控制器文件</h2><p>Magento 2 使用传统的PHP“将 URL 转化为控制器类名”的方法。让我们再来看看我们的URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://magento.example.com/hello_mvvm/hello/world</span><br></pre></td></tr></table></figure>

<p>要找出控制器的类名，Magento 2 将会查看 URL 第二和第三部分（<code>hello</code>和<code>world</code>）</p>
<ol>
<li>因为我们声明了<code>Pulsestorm_HelloWorldMVVM</code>的 front name 为<code>hello_mvvm</code>，所以控制器的名称以<code>Pulsestorm\HelloWorldMVVM</code>为开头。</li>
<li>因为我要定义一个控制器，所以接下来增加一个<code>Controller</code>（<code>Pulsestorm\HelloWorldMVVM\Controller</code>）</li>
<li>接下来 Magento 把 URL 的第二部分(hello)添加进去，首字母大写。（<code>Pulsestorm\HelloWorldMVVM\Controller\Hello</code>）</li>
<li>然后 Magento 把 URL 的第三部分（world）添上去，首字母大写。（Pulsestorm\HelloWorldMVVM\Controller\Hello\World）</li>
</ol>
<p>现在我们有控制器的全名了<code>Pulsestorm\HelloWorldMVVM\Controller\Hello\World</code>。现在创建这个文件吧。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/Controller/Hello/World.php</span><br><span class="line">&lt;?php</span><br><span class="line">namespace Pulsestorm\HelloWorldMVVM\Controller\Hello;</span><br><span class="line">class World extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &#x27;&lt;p&gt;You Did It!&lt;/p&gt;&#x27;;</span><br><span class="line">        var_dump(__METHOD__);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制器文件的位置和他的全名是对应的（PSR-0标准）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Class Name: Pulsestorm\HelloWorldMVVM\Controller\Hello\World;</span><br><span class="line">   app/code/Pulsestorm/HelloWorldMVVM/Controller/Hello/World.php</span><br></pre></td></tr></table></figure>

<p><code>Magento\Framework\App\Action\Action</code>是前端控制器的基类。(Action 这个名字源于历史名称”action controller”)</p>
<p>在 Magnento 2 系统中，每个控制器有且仅有一个入口，就是<code>execute</code>方法。Magento 2 的设计师这样设计是为了帮助避免冲突，在一个大的开发团队中很多人都修改同一个控制器文件实现不同的功能，如果入口还不同是很容易冲突的。</p>
<p>上面的工作都完成后，载入这个 URL 试试看吧。（当然记得先清空生成的缓存）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://magento.example.com/hello_mvvm/hello/world</span><br></pre></td></tr></table></figure>

<p>假如你正确地跟着上面的步骤做了，那你应该看到如下输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">You Did It</span><br><span class="line">string &#x27;Pulsestorm\HelloWorldMVVM\Controller\Hello\World::execute&#x27; (length=57)</span><br></pre></td></tr></table></figure>

<p>恭喜你！你已经创建了自己的第一个 Magneto 2 controller</p>
<h2 id="passing-off-to-the-view"><a href="#passing-off-to-the-view" class="headerlink" title="passing off to the view"></a><a href="#passing-off-to-the-view"></a>passing off to the view</h2><p>前面我们说到控制器的任务有：</p>
<ul>
<li>决定使用哪个 page layout</li>
<li>Handling saving data from <code>POST</code> requests</li>
<li>下面两件事情之一：<ul>
<li>让系统 render HTTP response</li>
<li>将用户重定向到下一页或上一页</li>
</ul>
</li>
</ul>
<p>今天我们只示范控制器让系统 render HTTP response。Magento 2 系统中，如果你想让控制器渲染（render）一个 HTML　Page，你得让控制器返回一个”page” objec。这是一个三步的过程：</p>
<ol>
<li>You need to inject a “page factory” object via automatic constructor dependency injection</li>
<li>使用上面的 page factory 对象来创建一个 page 对象</li>
<li>返回上面创建的 page 对象。</li>
</ol>
<p>实际上没有听起来这么复杂。修改你的控制器文件让他像下面这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Pulsestorm\HelloWorldMVVM\Controller\Hello;</span><br><span class="line">use Magento\Framework\View\Result\PageFactory;</span><br><span class="line">use Magento\Framework\App\Action\Context;</span><br><span class="line"></span><br><span class="line">class World extends \Magento\Framework\App\Action\Action</span><br><span class="line">&#123;</span><br><span class="line">    protected $pageFactory;</span><br><span class="line">    public function __construct(Context $context, PageFactory $pageFactory)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;pageFactory = $pageFactory;</span><br><span class="line">        return parent::__construct($context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function execute()</span><br><span class="line">    &#123;</span><br><span class="line">        var_dump(__METHOD__);</span><br><span class="line">        $page_object = $this-&gt;pageFactory-&gt;create();;</span><br><span class="line">        return $page_object;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>清空缓存以及<code>var/generation</code>里的内容，然后重新载入你的页面。你可能会困惑，因为你只看到<code>var_dump</code>输出的方法名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">string &#x27;Pulsestorm\HelloWorldMVVM\Controller\Hello\World::execute&#x27; (length=57)</span><br></pre></td></tr></table></figure>

<p>但是，如果你查看网页的源代码，你应该看到类似下面的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;html &gt;</span><br><span class="line">&lt;head &gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;/&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;</span><br><span class="line">&lt;meta name=&quot;description&quot; content=&quot;Default Description&quot;/&gt;</span><br><span class="line">&lt;meta name=&quot;keywords&quot; content=&quot;Magento, Varien, E-commerce&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>这里的问题并不是代码有误——这是因为我们还没有告诉layout system 它需要给<code>http://magento.example.com/hello_mvvm/hello/world</code>页面做点什么。正因为如此，Magento 渲染了 HTML 的结构，但是没有填入内容。接下来我们会了解怎么告诉 layout system 做事，但是首先我们得解释一下上面我们做了什么。</p>
<p>下面两行改变</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use Magento\Framework\View\Result\PageFactory;</span><br><span class="line">use Magento\Framework\App\Action\Context;</span><br></pre></td></tr></table></figure>

<p>严格来说并非必须的，但他让我们下面可以使用<code>PageFactory</code>和<code>Context</code>短的类名，如果你对PHP的命名空间不是很熟悉，可以参考<a target="_blank" rel="noopener" href="http://alanstorm.com/php_namespace_primer/">short primer is a great place to start</a></p>
<p>接着是我们的constructor</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">protected $pageFactory;</span><br><span class="line">public function __construct(Context $context, PageFactory $pageFactory)</span><br><span class="line">&#123;</span><br><span class="line">    $this-&gt;pageFactory = $pageFactory;</span><br><span class="line">    return parent::__construct($context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是 Magento 2 的依赖注入（automatic constructor dependency injection）起作用——如果你对这个不是很熟悉，你可以参考<a target="_blank" rel="noopener" href="http://alanstorm.com/category/magento/#magento_2_object_system">our object manager series</a>。简单说来，Magento 有一些神奇的代码，当你在构造函数参数中写下某个类后，它就会自动帮你构造这个类的对象。所以，就这样我们创建了<code>PageFactory</code>的对象，并且把他赋给<code>pageFactory</code>属性。</p>
<p>即使你对依赖注入很熟悉，上面的<code>$context</code>变量可能也会使你很困惑。 This is here because it’s also in the parent object’s (<code>Magento\Framework\App\Action\Action</code>) constructor, and we need to call <code>parent::__construct</code> to make sure any work in the parent constructor still happens.</p>
<p>最后，一切都到了<code>execute</code>方法中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public function execute()</span><br><span class="line">&#123;</span><br><span class="line">    var_dump(__METHOD__);</span><br><span class="line">    $page_object = $this-&gt;pageFactory-&gt;create();;</span><br><span class="line">    return $page_object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里我们使用<code>PageFactory</code>对象创建一个page 对象，并且把他返回出去。</p>
<h2 id="creating-the-view"><a href="#creating-the-view" class="headerlink" title="creating the view"></a><a href="#creating-the-view"></a>creating the view</h2><p>对最终程序员用户（我们），Magento 的 Page Layout 系统是通过 XML based domain specific language 来控制的。直白一点，这意味着我们可以通过创建包含指令的 XML 文件来告诉layout system 干什么。完整讲解 layout 系统已经超出本文的范围了（另开一篇也讲不完），如果你有问题，请在 Alan 的博客下评论，或者去 Stack Exchange 提问。</p>
<p>先做下面的事情，创建下面的文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/layout/hello_mvvm_hello_world.xml --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;page xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; layout=&quot;1column&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../../../lib/internal/Magento/Framework/View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;referenceBlock name=&quot;content&quot;&gt;</span><br><span class="line">        &lt;block</span><br><span class="line">            template=&quot;content.phtml&quot;</span><br><span class="line">            class=&quot;Pulsestorm\HelloWorldMVVM\Block\Main&quot;</span><br><span class="line">            name=&quot;pulsestorm_helloworld_mvvm&quot;/&gt;</span><br><span class="line">    &lt;/referenceBlock&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<p>之后创建下面的 php <code>Block</code> 类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/Block/Main.php</span><br><span class="line">&lt;?php</span><br><span class="line">namespace Pulsestorm\HelloWorldMVVM\Block;</span><br><span class="line">use Magento\Framework\View\Element\Template;</span><br><span class="line"></span><br><span class="line">class Main extends Template</span><br><span class="line">&#123;</span><br><span class="line">    protected function _prepareLayout()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，创建如下<code>phtml</code>模板</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/templates/content.phtml</span><br><span class="line">&lt;h1&gt;Hello World&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>上面都做好了以后，清空缓存和生成的代码（<code>var/generation</code>）重新载入页面，你现在应该看到_Hello World_标题被 Magento 的设计包围着。</p>
<h3 id="what-just-happened"><a href="#what-just-happened" class="headerlink" title="what just happened"></a><a href="#what-just-happened"></a>what just happened</h3><p>接下来的几个小节我们会解释上面做的事情——上面一个小节可能是本篇文章中最让人困惑的部分了。我们正在引入新的术语，重新定义 Magento 1 的术语。你不需要完全理解这些部分才能继续，不过这是深入了解 Magento 核心代码的伟大起点。</p>
<p>Even if the next few sections are a little over your head, you’ll definitely want to skip ahead to the View&#x2F;View Model section near the end.</p>
<h3 id="The-Full-Action-Name-Layout-Handle-XML-File"><a href="#The-Full-Action-Name-Layout-Handle-XML-File" class="headerlink" title="The Full Action Name Layout Handle XML File"></a><a href="#the-full-action-name-layout-handle-xml-file"></a>The Full Action Name Layout Handle XML File</h3><p>让我们从创建的 XML 文件说起</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/layout/hello_mvvm_hello_world.xml --&gt;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;page xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; layout=&quot;1column&quot; xsi:noNamespaceSchemaLocation=&quot;../../../../../../../lib/internal/Magento/Framework/View/Layout/etc/page_configuration.xsd&quot;&gt;</span><br><span class="line">    &lt;referenceBlock name=&quot;content&quot;&gt;</span><br><span class="line">        &lt;block</span><br><span class="line">            template=&quot;content.phtml&quot;</span><br><span class="line">            class=&quot;Pulsestorm\HelloWorldMVVM\Block\Main&quot;</span><br><span class="line">            name=&quot;pulsestorm_helloworld_mvvm&quot;/&gt;</span><br><span class="line">    &lt;/referenceBlock&gt;</span><br><span class="line">&lt;/page&gt;</span><br></pre></td></tr></table></figure>

<p>这个文件被称为<code>full action name layout handle XML file</code>。之前我们提到，开发者通过 XML 文件中的指令告诉 Magneto Page Layout 系统做什么事情。这就是那个 XML 文件。<strong>Layout handle</strong> 就像是 Page Layout 系统的事件或是消息。每个 page 会触发某些 handles，这些 handles 告诉 Magento 哪些 Layout Handle XML Files 应该被加载。</p>
<p>每个控制器页面触发一个<code>full action name</code>handle。一个 full action name 是一个组合了<code>&lt;route/&gt;</code> ID （<code>hello_mvvm</code>通常唯一确定front name）以及URL第二和第三部分（<code>hello</code> 和 <code>world</code>）的字符串。在我们的例子中，full acton name 就是<code>hello_mvvm_hello_world</code></p>
<p>所以，当我们创建名为<code>hello_mvvm_hello_world</code>的文件时，相当于告诉 Magento：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">如果触发了hello_mvvm_hello_world handle，请使用这个文件中的布局指令。</span><br></pre></td></tr></table></figure>

<p>至于该文件在模块文件夹中的层次位置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app/code/Pulsestorm/HelloWorldMVVM/view/frontend/layout/hello_mvvm_hello_world.xml</span><br></pre></td></tr></table></figure>

<p>Magento 的每个模块都有一个<code>view</code>文件夹，用来放视图相关的文件。在<code>view</code>目录下是为单独的application area 准备的子文件夹（上面的例子application area 指的是<code>frontend</code>），在<code>area</code>文件夹下是为特定的文件类型准备的文件夹（<code>layout</code>文件，<code>template</code>文件等）</p>
<p>最后，layout 文件中的指令是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/layout/hello_mvvm_hello_world.xml --&gt;</span><br><span class="line">&lt;referenceBlock name=&quot;content&quot;&gt;</span><br><span class="line">    &lt;block</span><br><span class="line">        template=&quot;content.phtml&quot;</span><br><span class="line">        class=&quot;Pulsestorm\HelloWorldMVVM\Block\Main&quot;</span><br><span class="line">        name=&quot;pulsestorm_helloworld_mvvm&quot;/&gt;</span><br><span class="line">&lt;/referenceBlock&gt;</span><br></pre></td></tr></table></figure>

<p>这些 XML 指令大致相当于下面的伪代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//pseudo code -- does not work</span><br><span class="line">$our_view_block = $layout-&gt;createNewBlockWithClass(&#x27;Pulsestorm\HelloWorldMVVM\Block\Main&#x27;)</span><br><span class="line">$our_view_block-&gt;setName(&#x27;pulsestorm_helloworld_mvvm&#x27;);</span><br><span class="line">$out_view_block-&gt;setTemplate(&#x27;content.phtml&#x27;);</span><br><span class="line">$layout-&gt;addBlockToContentContainer($our_view_block);</span><br></pre></td></tr></table></figure>

<p>大白话来说就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Magento，请你用Pulsestorm\HelloWorldMVVM\Block\Main 类实例化一个block 对象，这个对象要使用 content.phtml 模板进行渲染，并且给这个block 对象一个全局唯一的名字叫pulsestorm_helloworld_mvvm</span><br></pre></td></tr></table></figure>

<p>block 的名字应该是全局唯一的字符串，这样block 对象就可以被其他代码引用了。</p>
<h3 id="creating-a-block-class"><a href="#creating-a-block-class" class="headerlink" title="creating a block class"></a><a href="#creating-a-block-class"></a>creating a block class</h3><p>之前提到过，Magento 2 的 page layout 是嵌套的container 和 block 的聚集。上面，我们使用full action name handle XML 文件告诉 Magento 我们要插入一个<code>Pulsestorm\HelloWorldMVVM\Block\Main</code> block 对象。我们创建了这样的 block 类：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/Block/Main.php</span><br><span class="line">&lt;?php</span><br><span class="line">namespace Pulsestorm\HelloWorldMVVM\Block;</span><br><span class="line">use Magento\Framework\View\Element\Template;</span><br><span class="line"></span><br><span class="line">class Main extends Template</span><br><span class="line">&#123;</span><br><span class="line">    protected function _prepareLayout()</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Magento 的 block 类负责渲染 HTML 片段。上面 block 的基类是<code>Magento\Framework\View\Element\Template</code>，他是 Magento 的基本模板类。继承该类的block 会渲染他模板文件中的 HTML 内容。我们在layout handle XML 文件中设置了这个模板(content.phtml)</p>
<p>block 文件的路径和 Magento 系统中的所有 PHP 类一样，遵循 PSR-0 autoloader（<a href="/about-psr/">关于psr</a>）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">app/code/Pulsestorm/HelloWorldMVVM/Block</span><br><span class="line">         Pulsestorm\HelloWorldMVVM\Block</span><br></pre></td></tr></table></figure>

<h3 id="creating-a-template-file"><a href="#creating-a-template-file" class="headerlink" title="creating a template file"></a><a href="#creating-a-template-file"></a>creating a template file</h3><p>Magento 2 系统中的大多数 block 是 template block，这意味着他们渲染<code>phtml</code>模板。当我们添加了如下属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/layout/hello_mvvm_hello_world.xml --&gt;</span><br><span class="line">&lt;block &lt;!-- ... --&gt;</span><br><span class="line">    template=&quot;content.phtml&quot;</span><br><span class="line">&lt;!-- ... --&gt;</span><br></pre></td></tr></table></figure>

<p>就相当于我们告诉 Magento 我们希望 block 使用<code>content.phtml</code>模板文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/templates/content.phtml</span><br><span class="line">&lt;h1&gt;Hello World&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>模板文件被认为是view assets，所以他们属模块的<code>view</code>文件夹。像routes 和 layout 文件一样，他们有特定的 area(这里是frontend)，他们又属于<code>template</code>子文件夹。</p>
<p>如果你想的话也可以把模板放在<code>template</code>的子目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/layout/hello_mvvm_hello_world.xml --&gt;</span><br><span class="line">&lt;block &lt;!-- ... --&gt;</span><br><span class="line">    template=&quot;some/sub/folder/content.phtml&quot;</span><br><span class="line">&lt;!-- ... --&gt;</span><br></pre></td></tr></table></figure>

<h2 id="view-x2F-view-model"><a href="#view-x2F-view-model" class="headerlink" title="view&#x2F;view model"></a><a href="#view/view-model"></a>view&#x2F;view model</h2><p>到目前为止，我们已经完成所有的事项了。但是，还有最后一件要说。之前我们把 Magento 描述成 Model, View, View Model 系统，Magento blocks 是 View Model，phtml 模板是 View。下面说他们是怎么工作的。</p>
<p>打开 block 类，把下面的代码添加到<code>_prepareLayout</code>方法中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/Block/Main.php</span><br><span class="line">protected function _prepareLayout()</span><br><span class="line">&#123;</span><br><span class="line">    $this-&gt;setMessage(&#x27;Hello Again World&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后再你的<code>phtml</code>文件中，添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/templates/content.phtml</span><br><span class="line">&lt;h1&gt;&lt;?php echo $this-&gt;escapeHtml($this-&gt;getMessage()); ?&gt;&lt;/h1&gt;</span><br></pre></td></tr></table></figure>

<p>重新载入页面，这次你应该看到的是_Hello Again World_信息。</p>
<p>作为视图开发者，你需要自己获取或计算模板需要的数据。你可以通过模式方法<code>set</code>和<code>get</code>来完成工作，或者可以通过在 block 中直接定义方法，然后在phtml 模板中调用该方法来完成工作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/Block/Main.php</span><br><span class="line">public function getGoodbyeMessage()</span><br><span class="line">&#123;</span><br><span class="line">    return &#x27;Goodbye World&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/templates/content.phtml</span><br><span class="line">&lt;h2&gt;&lt;?php echo $this-&gt;escapeHtml($this-&gt;getGoodbyeMessage()); ?&gt;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>

<p>block 对象还允许你访问 request object —— 试着载入如下 URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://magento-2-july-8.dev/hello_mvvm/hello/world/name/bill</span><br></pre></td></tr></table></figure>

<p>和其他 PHP 框架类似，URL 第三部分以后的键值对被认为是参数。添加如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/Block/Main.php</span><br><span class="line">protected function _prepareLayout()</span><br><span class="line">&#123;</span><br><span class="line">    $this-&gt;setMessage(&#x27;Hello&#x27;);</span><br><span class="line">    $this-&gt;setName($this-&gt;getRequest()-&gt;getParam(&#x27;name&#x27;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 template</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#File: app/code/Pulsestorm/HelloWorldMVVM/view/frontend/templates/content.phtml</span><br><span class="line">&lt;h1&gt;</span><br><span class="line">    &lt;?php echo $this-&gt;escapeHtml($this-&gt;getMessage()); ?&gt;</span><br><span class="line">    &lt;?php echo $this-&gt;escapeHtml($this-&gt;getName()); ?&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;h2&gt;&lt;?php echo $this-&gt;escapeHtml($this-&gt;getGoodbyeMessage()); ?&gt;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>

<p>传统的PHP MVC 系统在控制器中设置视图中的变量值，Magneto 的做法和传统的有点不一样。Magento 2 使用 Model, View, View Model 分离了业务逻辑和模板逻辑。</p>
<p>对于大型的开发团队来说，每个人的职责明确，Magento 的这一改动对他们很可能是更有利的，但对全栈工程师来说不是很好，全站工程师需要考虑更多的抽象层次了。</p>
<p>Magento 1 是可以用<code>MVVM</code>模式的，但是1的<code>Zend Framework</code>roots(and its too many chefs problem)导致了对传统的 MVC 方式的极大偏爱，使用全局注册或者在调用loadLayout 后直接设置 block 的属性值。在Magento 2 中你再也不能直接设置block 对象的属性值了，不过注册对象还是存在的，不过非官方的推荐做法是避免用这个注册对象。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><a href="#%E6%80%BB%E7%BB%93"></a>总结</h2><p>Regardless of whether Magento 2’s patterns elicit a “finally PHP gets it”, or a “WTF is this”, you’ve just successfully created a new landing page and application entry point in Magento 2. You’ve also been exposed to core Magento 2 concepts like clearing the cache, clearing generated files, and the hierarchy of configuration and view files in a Magento 2 module. You’re well on your way to unlocking the mysteries of Magento 2, and all the opportunities that will open for you in the future.</p>
<h2 id="相关源文件下载"><a href="#相关源文件下载" class="headerlink" title="相关源文件下载"></a><a href="#%E7%9B%B8%E5%85%B3%E6%BA%90%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"></a>相关源文件下载</h2><p><a target="_blank" rel="noopener" href="https://github.com/PiscesThankIT/HelloWorldMVVM">https://github.com/PiscesThankIT/HelloWorldMVVM</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/magento-2-request-flow/" rel="prev" title="Magento 2 的请求处理流程">
      <i class="fa fa-chevron-left"></i> Magento 2 的请求处理流程
    </a></div>
      <div class="post-nav-item">
    <a href="/magento-2-include-css/" rel="next" title="Magento 2 如何引入 CSS">
      Magento 2 如何引入 CSS <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E2%80%9CCache-Clearing%E2%80%9D%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-number">1.</span> <span class="nav-text">关于“Cache Clearing”的注意点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Magento-2-Hello-World-Module"><span class="nav-number">2.</span> <span class="nav-text">Magento 2 Hello World Module</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA-Magento-2-%E7%9A%84-Module"><span class="nav-number">3.</span> <span class="nav-text">创建一个 Magento 2 的 Module</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%96%91%E9%9A%BE%E8%A7%A3%E7%AD%94"><span class="nav-number">4.</span> <span class="nav-text">安装疑难解答</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0-controller-action"><span class="nav-number">5.</span> <span class="nav-text">添加 controller action</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Magnento-2-%E7%9A%84%E8%B7%AF%E7%94%B1"><span class="nav-number">6.</span> <span class="nav-text">Magnento 2 的路由</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E6%96%87%E4%BB%B6"><span class="nav-number">7.</span> <span class="nav-text">新建控制器文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#passing-off-to-the-view"><span class="nav-number">8.</span> <span class="nav-text">passing off to the view</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#creating-the-view"><span class="nav-number">9.</span> <span class="nav-text">creating the view</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#what-just-happened"><span class="nav-number">9.1.</span> <span class="nav-text">what just happened</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Full-Action-Name-Layout-Handle-XML-File"><span class="nav-number">9.2.</span> <span class="nav-text">The Full Action Name Layout Handle XML File</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#creating-a-block-class"><span class="nav-number">9.3.</span> <span class="nav-text">creating a block class</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#creating-a-template-file"><span class="nav-number">9.4.</span> <span class="nav-text">creating a template file</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#view-x2F-view-model"><span class="nav-number">10.</span> <span class="nav-text">view&#x2F;view model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">11.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B8%E5%85%B3%E6%BA%90%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD"><span class="nav-number">12.</span> <span class="nav-text">相关源文件下载</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ThankIT</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">320</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">137</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ThankIT</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
